<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <!-- module category for branch -->
    <record model="ir.module.category" id="module_category_branch">
        <field name="name">Branch</field>
        <field name="description">Helps Manager to create the branch.</field>
        <field name="sequence">9</field>
    </record>
    <!-- Branch User Group -->
    <record id="group_branch_user" model="res.groups">
      <field name="name">User</field>
      <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
      <field name="category_id" ref="pos_multi_branch.module_category_branch"/>
    </record>

    <record id="group_no_branch_user" model="res.groups">
      <field name="name">Non branch User</field>
      <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <!-- Branch Manager Group -->
    <record id="group_branch_manager" model="res.groups">
        <field name="name">Manager</field>
        <field name="category_id" ref="pos_multi_branch.module_category_branch" />
        <field
            name="users"
            eval="[(4, ref('base.user_root')), (4, ref('base.user_admin'))]"
        />
    </record>

    <!-- =================== pos order ======================== -->

  	<record id="pos_order_branch_manager_rule" model="ir.rule">
  		<field name="name">POS Order Branch Manager</field>
  		<field name="model_id" ref="model_pos_order"/>
  		<field
        name="domain_force"
        >['|',('branch_id','in',[branch.id for branch in user.branch_ids]),('branch_id','=',False)]</field>
  		<field
        name="groups"
        eval="[(4,ref('sales_team.group_sale_salesman_all_leads')),(4,ref('sales_team.group_sale_manager'))]"
        />
  	</record>

  	<record id="pos_order_branch_user_rule" model="ir.rule">
  		<field name="name">POS Order Branch User</field>
  		<field name="model_id" ref="model_pos_order"/>
  		<field
        name="domain_force"
        >['|', ('branch_id','=',False),('branch_id','=',user.branch_id.id)]</field>
  		<field
        name="groups"
        eval="[(4, ref('pos_multi_branch.group_branch_user'))]"
        />
  	</record>

  	<record id="pos_order_non_branch_user_rule" model="ir.rule">
  		<field name="name">POS Order Non Branch User</field>
  		<field name="model_id" ref="model_pos_order"/>
  		<field
        name="domain_force"
        >[('branch_id','=',False)]</field>
  		<field
        name="groups"
        eval="[(4, ref('group_no_branch_user'))]"
        />
  	</record>

    <!-- =================== pos session ======================== -->

  	<record id="rule_branch_pos_session" model="ir.rule">
  		<field name="name">POS Session Branch Manager</field>
  		<field name="model_id" ref="model_pos_session"/>
  		<field
        name="domain_force"
      >['|', ('branch_id', '=', False), ('branch_id', 'in', [branch.id for branch in user.branch_ids])]</field>
  		<field
        name="groups"
        eval="[(4,ref('sales_team.group_sale_salesman_all_leads')),(4,ref('sales_team.group_sale_manager'))]"
        />
  	</record>

    <record id="pos_session_branch_user_rule" model="ir.rule">
      <field name="name">POS Session Branch User</field>
      <field name="model_id" ref="model_pos_session"/>
      <field name="global" eval="True"/>
      <field
        name="domain_force"
      >['|', ('branch_id','=',False),('branch_id','=',user.branch_id.id)]</field>
      <field
        name="groups"
        eval="[(4, ref('pos_multi_branch.group_branch_user'))]"
        />
    </record>

    <record id="pos_ssn_non_branch_user_rule" model="ir.rule">
      <field name="name">POS Session Non Branch User</field>
      <field name="model_id" ref="model_pos_session"/>
      <field name="global" eval="True"/>
      <field
        name="domain_force"
      >[('branch_id','=',False)]</field>
      <field
        name="groups"
        eval="[(4, ref('group_no_branch_user'))]"
        />
    </record>

    <!-- =================== pos config ======================== -->

    <record id="rule_branch_pos_config" model="ir.rule">
      <field name="name">POS Config Branch Manager</field>
      <field name="model_id" ref="model_pos_config"/>
      <field
        name="domain_force"
      >['|', ('branch_id', '=', False), ('branch_id', 'in', [branch.id for branch in user.branch_ids])]</field>
      <field
        name="groups"
        eval="[(4,ref('sales_team.group_sale_salesman_all_leads')),(4,ref('sales_team.group_sale_manager'))]"
        />
    </record>

    <record id="pos_config_branch_user_rule" model="ir.rule">
      <field name="name">POS Config Branch User</field>
      <field name="model_id" ref="model_pos_config"/>
      <field
        name="domain_force"
      >['|', ('branch_id','=',False),('branch_id','=',user.branch_id.id)]</field>
      <field
        name="groups"
        eval="[(4, ref('pos_multi_branch.group_branch_user'))]"
        />
    </record>

    <record id="pos_config_non_branch_user_rule" model="ir.rule">
      <field name="name">POS Config Non Branch User</field>
      <field name="model_id" ref="model_pos_config"/>
      <field name="global" eval="True"/>
      <field
        name="domain_force"
      >[('branch_id','=',False)]</field>
      <field
        name="groups"
        eval="[(4, ref('group_no_branch_user'))]"
        />
    </record>

</odoo>
